<meta name="viewport" content="width=device-width, initial-scale=1.0">

<%- include('blocks/header', {bot, user, path}) %>
<div class="container">
	<h1 class="display-3" style="color: #ffffff;">Yönetim Paneli</h1>
	<ul class="list-unstyled">
    <% const guilds_w_perm = user.guilds.filter(user => (user.permissions & 214) == 214 || null)
      guilds_w_perm.forEach(guild => {
    %>
			<li class="media" style="padding: 10px;">
					<% if (guild.icon) { %>
						<img class="d-flex mr-3 rounded-circle" src="<%= `https://cdn.discordapp.com/icons/${guild.id}/${guild.icon}.png?size=128` %>" style="width: 80px;" alt="">
					<% } else { %>
						<canvas style="background-color: #7289da" class="d-flex mr-3 rounded-circle" id="<%= guild.name.split(' ').join('').replace(`'`, ``) %>" width="80px" height="80px"></canvas>
						<script>
							function draw() {
								const ctx = document.getElementById("<%= guild.name.split(' ').join('').replace(`'`, ``) %>").getContext('2d');
								ctx.font = '30px Arial';
								ctx.textAlign = "center";
								ctx.fillStyle = "white";
								ctx.fillText("<%= guild.name.split(' ').map(v => v[0]).join('') %>", 40, 50);
							};
							draw();
						</script>
					<% } %>
					<div class="media-body">
          <h5 class="mt-0 mb-1" style="color: #fffff;"><%= guild.name %></h5></center>
					<% 
					let href, text;
					let enabled;
					if(bot.guilds.cache.get(guild.id)) {
						href = '/sunucular/' + guild.id + '/yonet';
						text = "Yönet";
						enabled = true;
					} else {
						href = 'https://discordapp.com/oauth2/authorize?client_id=453610237610688512&scope=bot&permissions=2146958591';
						text = "Sunucuna Ekle";
						enabled = bot.appInfo.botPublic;
					}
					%> 
        <a class="btn btn-primary btn-lg<% if(!enabled) { %> disabled<% } %>" role="button" href="<%= href %>"><%= text %> <i aria-hidden="true"></i></a>
			</div>
		</li>
		<% }); %>
	</ul>
<% include ./blocks/footer %>